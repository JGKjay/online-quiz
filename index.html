<!DOCTYPE html>
<html>
<head>
  <title>Student Quiz System</title>
  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      text-align: center;
      padding: 40px;
    }
    .box {
      background: white;
      padding: 25px;
      width: 350px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px gray;
    }
    input, button {
      padding: 10px;
      width: 90%;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
    }
  </style>
</head>

<body>

<div class="box" id="mainBox">
  <h2>Online Quiz System</h2>
  <button onclick="studentPage()">Start Quiz (Student)</button>
  <button onclick="adminLogin()">Admin Login</button>
</div>

<script>
const ADMIN_PASSWORD = "0987654321";

let studentName = "";
let index = 0;
let score = 0;

/* ✅ QUIZ QUESTIONS */
const questions = [
  {
    q: "2 + 2 = ?",
    options: ["1", "2", "3", "4"],
    ans: 3
  },
  {
    q: "Capital of India?",
    options: ["Mumbai", "Delhi", "Pune", "Chennai"],
    ans: 1
  },
  {
    q: "5 x 3 = ?",
    options: ["10", "15", "20", "25"],
    ans: 1
  },
  {
    q: "Which is a programming language?",
    options: ["HTML", "CSS", "JavaScript", "Photoshop"],
    ans: 2
  }
];

/* ✅ STUDENT SECTION */

function studentPage() {
  document.getElementById("mainBox").innerHTML = `
    <h2>Enter Your Full Name</h2>
    <input type="text" id="nameInput" placeholder="Full Name">
    <button onclick="startQuiz()">Start Quiz</button>
  `;
}

function startQuiz() {
  studentName = document.getElementById("nameInput").value.trim();
  if (studentName === "") {
    alert("Please enter your name");
    return;
  }
  index = 0;
  score = 0;
  showQuestion();
}

function showQuestion() {
  let q = questions[index];
  let html = `<h3>Question ${index + 1} of ${questions.length}</h3>`;
  html += `<h2>${q.q}</h2>`;

  q.options.forEach((opt, i) => {
    html += `<button onclick="checkAnswer(${i})">${opt}</button><br>`;
  });

  document.getElementById("mainBox").innerHTML = html;
}

function checkAnswer(selected) {
  if (selected === questions[index].ans) {
    score++;
  }
  index++;

  if (index < questions.length) {
    showQuestion();
  } else {
    saveResult();
    showResult();
  }
}

function showResult() {
  document.getElementById("mainBox").innerHTML = `
    <h2>Quiz Completed ✅</h2>
    <h3>Name: ${studentName}</h3>
    <h3>Score: ${score} / ${questions.length}</h3>
    <button onclick="location.reload()">Go Home</button>
  `;
}

function saveResult() {
  let results = JSON.parse(localStorage.getItem("quizResults")) || [];
  results.push({ name: studentName, score: score });
  localStorage.setItem("quizResults", JSON.stringify(results));
}

/* ✅ ADMIN SECTION */

function adminLogin() {
  document.getElementById("mainBox").innerHTML = `
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Password">
    <button onclick="verifyAdmin()">Login</button>
  `;
}

function verifyAdmin() {
  let pass = document.getElementById("adminPass").value;
  if (pass !== ADMIN_PASSWORD) {
    alert("Wrong Password!");
    return;
  }
  showAdminPanel();
}

function showAdminPanel() {
  let results = JSON.parse(localStorage.getItem("quizResults")) || [];

  let html = `<h2>Admin Panel</h2>
              <button onclick="downloadExcel()">Download Excel</button>
              <button onclick="location.reload()">Logout</button>
              <table>
              <tr><th>Student Name</th><th>Score</th></tr>`;

  results.forEach(r => {
    html += `<tr><td>${r.name}</td><td>${r.score}</td></tr>`;
  });

  html += `</table>`;

  document.getElementById("mainBox").innerHTML = html;
}

/* ✅ EXCEL DOWNLOAD (CSV) */

function downloadExcel() {
  let results = JSON.parse(localStorage.getItem("quizResults")) || [];
  if (results.length === 0) {
    alert("No student data found");
    return;
  }

  let csv = "Student Name,Score\n";
  results.forEach(r => {
    csv += `${r.name},${r.score}\n`;
  });

  let blob = new Blob([csv], { type: "text/csv" });
  let url = URL.createObjectURL(blob);

  let a = document.createElement("a");
  a.href = url;
  a.download = "quiz_results.csv";
  a.click();
}
</script>

</body>
</html>
